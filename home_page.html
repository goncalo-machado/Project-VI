<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <script type="text/javascript" src="http://d3js.org/d3.v7.js"></script>

    <!-- Title tha appears in the searcher tab  -->
    <title>DETI Courses Data Visualisation</title>

    <!-- CSS -->
    <style>

        /* Config of entery site */
        *{
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        html, body {
            width: 100%;
            height: 100%;
            padding: 0;
            margin: 0;
        }

        /* For the Main Title */
        h1{
            font-family: Arial, sans-serif;
            color: black; /* Cores: https://www.w3schools.com/cssref/css_colors.php */
            font-size: 50px;
            text-align: center;
            background-image: linear-gradient(90deg, white, lightblue, white);
            background-size: 100% 3px;
            background-position: 0 100%;
            padding: 20px 0;
        }

        /* To the H2 Title */
        h2{
            color: black;
            font-size: 25px;
            padding-left: 5px;
        }

        /* Confi the H2 and the dropList*/
        .H2_dropList {
            display: flex;
            align-items: center;
        }

        /* Configuration of the droplist */
       .droplist_year{
            font-family: Arial, sans-serif;
            color: black;
            font-size: 25px;
            border: none;
            margin-left: 5px;
        }

        /* Config the Buttons*/
        .buttons_DETI_courses {
            display: flex;
            flex-direction: linear;
            align-items: center;
        }

        /* Style of the buttons */
        .buttons_DETI{
            background-color: lightblue;
            color: black;
            font-size: 20px;
            margin-left: 5px;
            border-radius: 5px;
            border: none;
        }

        /* Config do d3 */
        .div_d3 {
            display: flex;
            justify-content: center;

        }

    </style>

</head>

<body>

    <!-- Main Title -->
    <h1> DETI Courses Data Visualisation </h1>

    <!-- Define the Buttons for each DETI course -->
    <div class="buttons_DETI_courses">
        <button class="buttons_DETI" id="button_Aer_Eng"> Aerospace Engineering</button>
        <button class="buttons_DETI" id="button_Bio_Eng"> Biomedical Engineering</button>
        <button class="buttons_DETI" id="button_CS_Eng"> Computer Science and Engineering</button>
        <button class="buttons_DETI" id="button_Comp_Eng"> Computational Engineering</button>
        <button class="buttons_DETI" id="button_CompEng_Inf"> Computer Engineering and Informatics</button>
        <button class="buttons_DETI" id="button_EleComp_Eng"> Electrical and Computer Engineering</button>
        <button class="buttons_DETI" id="button_IndAut_Eng"> Industrial Automation Engineering</button>
    </div>

    <!-- Container for H2 title and the DropList with curriculam years -->
    <div class="H2_dropList">
        <!-- Title -->
        <h2> Curricular Year </h2>

        <!-- Define the DropList with curricular years -->
        <select id="droplist" class="droplist_year" onchange="year_selection()">
            <option value="2021"> 2021/22 </option>
            <option value="2022"> 2022/23 </option>
            <option value="2023"> 2023/24 </option>
        </select>
    </div>

    <!-- Other possibilitie for graphs: https://www.chartjs.org/ -->
    <!-- D3 Section - Front Page -->
    <div class="div_d3"> </div>

    <!-- Script that has all the charts -->
    <script type="text/javascript">

        // Set the dimensions and margins of the graph
        const margin = {top: 50, right: 50, bottom: 120, left: 50}, // Space for axis legends
                                width = 900 - margin.left - margin.right,
                                height = 1000 - margin.top - margin.bottom;

        // Create the SVG (the space) to put the Bar Chart of the number of applicants by DETI course
        const bar_chart_SVG = d3.select(".div_d3")
                                .append("svg")
                                    .attr("width", width + margin.left + margin.right)
                                    .attr("height", height + margin.top + margin.bottom)
                                    .style("background", "#DCDCDC") // Just to see the space
                                .append("g") // Section to plot the axis legends
                                    .attr("transform", `translate(${margin.top})`);
        
        // Get the selected item in the droplist
        year_selection()
        // Evething needs to change when the value in the droplist changes
        function year_selection(){
            // Define the Dataset with all data
            d3.csv("https://raw.githubusercontent.com/goncalo-machado/Project-VI/main/Dataset_Applicants_2021_2023.csv?token=GHSAT0AAAAAACJ32OOFC7YF6MSVXECN6KJMZKI52DQ").then(function(total_data) {

                // Data set with Last Placed Candidates Grades
                d3.csv("https://raw.githubusercontent.com/goncalo-machado/Project-VI/main/Dataset_DETI_Courses_2021_2023.csv?token=GHSAT0AAAAAACJ32OOEUYT2WTOYHLZXJVHYZKJAULQ").then(function(data_last_grade) {

                    // Filter the data needed for X, that is, DETI courses
                    const x_axis_filter = data_last_grade.filter(d => d['University Code'] === '0300' && d.Year === '2021');
                    // Get the X information, that is, DETI courses to X axis
                    const x = d3.scaleBand()
                                .domain(x_axis_filter.map(d => d['Course Name']))
                                .range([ 0, width ])
                                .padding(0.2);
                    // Plot the X information in the axis
                    bar_chart_SVG.append("g")
                                    .attr("transform", `translate(0, ${height})`)
                                    .call(d3.axisBottom(x))
                                .selectAll("text")
                                    .attr("transform", "translate(-10,0)rotate(-45)")
                                    .style("text-anchor", "end");

                    // Condition that checks which droplist item is selected
                    var droplist_items = document.getElementById("droplist"); // Select the droplist
                    var droplist_item_selected = droplist_items.options[droplist_items.selectedIndex].value; // Get the item
                    console.log(droplist_item_selected); // Check which droplist item is selected
                    console.log(typeof droplist_item_selected) // Check which type is

                    // Filter the data needed for Y, that is, number of applicants for each DETI course
                    const y_axis_filter = total_data.filter(d => d['University Code'] === '0300' && d.Year === droplist_item_selected);

                    // Creat a new dataset to store the number of applicants for each DETI course
                    n_applicants_count = {};

                    // For each course, count the number of applicants
                    y_axis_filter.forEach(d => {
                        // Define the curse code
                        const course_code = d["Course Code"];
                        // If the coourse code was alredy detected, increment
                        if(n_applicants_count[course_code]){
                            n_applicants_count[course_code] += 1; // Count one student
                        }
                        else{
                            n_applicants_count[course_code] = 1; // Count the first apperance
                        }
                    });

                    /* TO VERIFY IF THE COUNTING IS WORKING WELL */
                    const dataset_n_applicants_count = Object.keys(n_applicants_count).map(courseCode => {
                        return { "Course Code": courseCode, "Count": n_applicants_count[courseCode] };
                    });
                    console.log(dataset_n_applicants_count);
                    /* ----------------------------------------- */

                })

            })

        }

    </script>

</body>

</html>